<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BenjiShop — Admin</title>

  <style>
    :root{
      --bg:#02030a;
      --card-bg:#050714;
      --brand:#00f5ff;
      --brand-soft:#00f5ff33;
      --text:#f6f7fb;
      --muted:#a3a7c0;
      --radius:14px;
      --shadow:0 12px 40px rgba(0,0,0,.8);
      --danger:#ff3366;
      --success:#3be577;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{
      height:100%;
      font-family:"Inter","Segoe UI",system-ui,sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    body{
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }

    .bg-root{
      position:fixed;
      inset:0;
      z-index:-3;
      background:
        radial-gradient(circle at 10% 0%, rgba(0,245,255,0.18) 0, transparent 55%),
        radial-gradient(circle at 90% 100%, rgba(0,245,255,0.16) 0, transparent 55%),
        #02030a;
    }

    .card{
      width:100%;
      max-width:800px;
      background:linear-gradient(145deg, rgba(9,11,30,0.98), rgba(6,8,22,0.98));
      border-radius:var(--radius);
      border:1px solid rgba(0,245,255,0.25);
      box-shadow:var(--shadow), 0 0 30px rgba(0,245,255,0.25);
      padding:22px 20px 20px;
      position:relative;
      overflow:hidden;
    }

    .logo{
      font-weight:800;
      font-size:20px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:var(--muted);
      margin-bottom:10px;
    }
    .logo b{
      color:var(--brand);
      text-shadow:0 0 16px var(--brand-soft);
    }

    h1{
      font-size:18px;
      margin-bottom:2px;
    }
    .subtitle{
      font-size:13px;
      color:var(--muted);
      margin-bottom:12px;
    }

    label{
      display:block;
      font-size:13px;
      margin-bottom:4px;
    }

    input, select{
      width:100%;
      padding:9px 10px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.12);
      background:rgba(2,4,15,0.9);
      color:var(--text);
      font-size:14px;
      outline:none;
      transition:border-color .18s, box-shadow .18s, background .18s;
    }

    input:focus, select:focus{
      border-color:var(--brand);
      box-shadow:0 0 0 1px rgba(0,245,255,0.4);
      background:rgba(3,6,20,0.9);
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      border-radius:999px;
      border:none;
      padding:9px 16px;
      font-size:14px;
      cursor:pointer;
      font-weight:600;
      margin-top:10px;
      background:linear-gradient(90deg, #00f5ff, #00b7ff);
      color:#02030a;
      box-shadow:0 0 20px rgba(0,245,255,0.6);
      transition:transform .15s, box-shadow .15s, filter .15s;
    }
    .btn:hover{
      transform:translateY(-1px);
      filter:brightness(1.05);
      box-shadow:0 0 24px rgba(0,245,255,0.8);
    }
    .btn:disabled{
      opacity:0.55;
      cursor:default;
      box-shadow:none;
      transform:none;
    }

    .field{
      margin-bottom:10px;
    }

    .row{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .row > .field{
      flex:1;
      min-width:0;
    }

    .small{
      font-size:11px;
      color:var(--muted);
      margin-top:4px;
    }

    .error{
      margin-top:6px;
      font-size:12px;
      color:var(--danger);
    }
    .success{
      margin-top:6px;
      font-size:12px;
      color:var(--success);
    }

    .divider{
      margin:16px 0 12px;
      border-top:1px solid rgba(255,255,255,0.12);
    }

    .logout{
      position:absolute;
      top:12px;
      right:16px;
      font-size:11px;
      color:var(--muted);
      cursor:pointer;
      text-decoration:underline;
      display:none;
    }
    .logout:hover{
      color:#fff;
    }

    #panel{ display:none; }

    /* Liste admin */
    .admin-list{
      margin-top:8px;
      max-height:260px;
      overflow:auto;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.1);
      background:rgba(2,4,15,0.8);
    }
    .admin-item{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:8px 10px;
      font-size:13px;
      border-bottom:1px solid rgba(255,255,255,0.06);
    }
    .admin-item:last-child{
      border-bottom:none;
    }
    .admin-main{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .admin-title{
      font-weight:600;
    }
    .admin-meta{
      font-size:11px;
      color:var(--muted);
    }
    .admin-actions{
      display:flex;
      gap:6px;
    }
    .btn-sm{
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.2);
      background:transparent;
      color:var(--text);
      font-size:11px;
      padding:4px 8px;
      cursor:pointer;
    }
    .btn-sm:hover{
      background:rgba(255,255,255,0.10);
    }
    .btn-danger{
      border-color:rgba(255,51,102,0.8);
      color:#ff99b5;
    }
    .btn-danger:hover{
      background:rgba(255,51,102,0.18);
    }
  </style>
</head>
<body>
  <div class="bg-root"></div>

  <div class="card">
    <div class="logout" id="logoutBtn">Déconnexion</div>

    <!-- LOGIN -->
    <section id="login">
      <div class="logo">Benji<b>Shop</b></div>
      <h1>Accès admin</h1>
      <p class="subtitle">Entre le mot de passe secret pour ouvrir le panel de vente.</p>

      <form id="loginForm">
        <div class="field">
          <label for="password">Mot de passe admin</label>
          <input type="password" id="password" autocomplete="current-password" required />
        </div>
        <button class="btn" type="submit" id="loginBtn">
          <span>Connexion</span>
        </button>
        <div class="error" id="loginError" style="display:none;"></div>
      </form>
    </section>

    <!-- PANEL -->
    <section id="panel">
      <div class="logo">Benji<b>Shop</b></div>
      <h1>Panel de vente BrainRot</h1>
      <p class="subtitle">
        Ajoute un nouveau BrainRot, choisis sa catégorie (perso), fixe le prix en €.
      </p>

      <form id="productForm">
        <div class="field">
          <label for="name">Nom du BrainRot (variation / skin)</label>
          <input type="text" id="name" required placeholder="Ex: La Grande Combinasion — Rainbow" />
        </div>

        <div class="row">
          <div class="field">
            <label for="category">Personnage / Catégorie d’accueil</label>
            <select id="category" required>
              <option value="">Choisis le perso…</option>
              <!-- adapte si besoin -->
              <option value="La Grande Combinasion">La Grande Combinasion</option>
              <option value="Eviledon">Eviledon</option>
              <option value="Mieteteira Bicicleteira">Mieteteira Bicicleteira</option>
              <option value="Los Primos">Los Primos</option>
              <option value="La Spooky Grande">La Spooky Grande</option>
              <option value="Los 67">Los 67</option>
              <option value="Chipso and Queso">Chipso and Queso</option>
              <option value="Celularcini Viciosini">Celularcini Viciosini</option>
              <option value="Perrito Burrito">Perrito Burrito</option>
              <option value="Esok Sekolah">Esok Sekolah</option>
              <option value="Garama and Madundung">Garama and Madundung</option>
              <option value="Chillin Chilli">Chillin Chilli</option>
              <option value="Autre">Autre / Nouveau perso</option>
            </select>
          </div>
          <div class="field">
            <label for="price">Prix (€)</label>
            <input type="number" id="price" required min="0" step="0.01" placeholder="Ex: 12" />
          </div>
        </div>

        <div class="field">
          <label for="image">Image (depuis ton PC)</label>
          <input type="file" id="image" accept="image/*" />
          <p class="small">
            Pour l’instant, le site utilise l’image du personnage sur la page d’accueil.
            Ce champ est là pour plus tard (variations spécifiques).
          </p>
        </div>

        <button class="btn" type="submit" id="saveBtn">
          <span>Enregistrer le BrainRot</span>
        </button>
        <div class="success" id="saveSuccess" style="display:none;"></div>
        <div class="error" id="saveError" style="display:none;"></div>
      </form>

      <div class="divider"></div>
      <h2 style="font-size:15px;margin-bottom:6px;">BrainRot actuellement en vente</h2>
      <p class="small">Tu peux voir tout ce qui est en base, et supprimer ce que tu veux.</p>

      <div class="admin-list" id="itemsList">
        <div class="small" style="padding:8px 10px;">Chargement…</div>
      </div>
    </section>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    const loginSection = $("login");
    const panelSection = $("panel");
    const loginForm = $("loginForm");
    const loginBtn = $("loginBtn");
    const loginError = $("loginError");
    const logoutBtn = $("logoutBtn");

    const productForm = $("productForm");
    const saveBtn = $("saveBtn");
    const saveSuccess = $("saveSuccess");
    const saveError = $("saveError");
    const itemsList = $("itemsList");

    function showPanel(){
      loginSection.style.display = "none";
      panelSection.style.display = "block";
      logoutBtn.style.display = "block";
      sessionStorage.setItem("benji_admin_ok","1");
      refreshList();
    }

    function logout(){
      sessionStorage.removeItem("benji_admin_ok");
      location.reload();
    }

    logoutBtn.addEventListener("click", logout);

    if (sessionStorage.getItem("benji_admin_ok") === "1"){
      showPanel();
    }

    // LOGIN
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      loginError.style.display = "none";
      loginError.textContent = "";

      const password = $("password").value.trim();
      if (!password) return;

      loginBtn.disabled = true;
      loginBtn.textContent = "Connexion...";

      try{
        const res = await fetch("/.netlify/functions/admin-login", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body:JSON.stringify({ password })
        });

        if (!res.ok){
          const data = await res.json().catch(() => ({}));
          loginError.textContent = data.error || "Mot de passe incorrect.";
          loginError.style.display = "block";
        }else{
          showPanel();
        }
      }catch(err){
        console.error(err);
        loginError.textContent = "Erreur serveur, réessaie.";
        loginError.style.display = "block";
      }finally{
        loginBtn.disabled = false;
        loginBtn.textContent = "Connexion";
      }
    });

    // LISTE ADMIN
    async function refreshList(){
      itemsList.innerHTML = '<div class="small" style="padding:8px 10px;">Chargement…</div>';
      try{
        const res = await fetch("/.netlify/functions/admin-products");
        if (!res.ok) throw new Error("HTTP "+res.status);
        const data = await res.json();
        const items = Array.isArray(data.items) ? data.items : [];

        if (!items.length){
          itemsList.innerHTML = '<div class="small" style="padding:8px 10px;">Aucun BrainRot en base pour le moment.</div>';
          return;
        }

        itemsList.innerHTML = items.map(p => `
          <div class="admin-item" data-id="${p.id}">
            <div class="admin-main">
              <div class="admin-title">${p.title || "(sans nom)"}</div>
              <div class="admin-meta">
                Perso : ${p.category || "?"} — Prix : ${(Number(p.price_eur)||0).toFixed(2)}€
